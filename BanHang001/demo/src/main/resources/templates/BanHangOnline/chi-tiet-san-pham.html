<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{index}">
<head>
    <meta charset="UTF-8">
    <title>Chi Ti·∫øt S·∫£n Ph·∫©m</title>
    <style>
        .img-dong-bo {
            width: 100%;
            max-width: 500px;
            height: 600px;
            object-fit: cover;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .muasam {
            margin-top: 50px;
        }
        .chu-song-mau {
            font-weight: bold;
            font-size: 1.3rem;
            background: linear-gradient(270deg, #ff0000, #ffa500, #ffff00, #008000, #0000ff, #4b0082, #ee82ee);
            background-size: 1400% 1400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: songMau 10s ease infinite;
        }
        @keyframes songMau {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .star {
            color: lightgray;
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        .star.selected {
            color: gold;
        }
    </style>
</head>

<body>
<section layout:fragment="content">
    <main class="flex-fill">
        <div class="container mt-5">
            <h2 class="text-center mb-4" th:text="${sanPham.tenSanPham}">T√™n s·∫£n ph·∫©m</h2>
            <div class="row">
                <!-- ·∫¢nh s·∫£n ph·∫©m -->
                <div class="col-md-6">
                    <img th:src="@{'/images/' + ${sanPham.anhDaiDien}}" class="img-dong-bo" alt="·∫¢nh s·∫£n ph·∫©m">
                </div>

                <!-- Th√¥ng tin v√† form -->
                <div class="col-md-6">
                    <p th:text="${sanPham.moTa}" class="chu-song-mau"></p>

                    <form th:action="@{/them-vao-gio-hang-chi-tiet}" method="post">
                        <input type="hidden" name="sanPhamId" th:value="${sanPham.id}" />

                        <!-- M√†u s·∫Øc -->
                        <label for="mauSac">Ch·ªçn m√†u s·∫Øc:</label>
                        <select name="mauSacId" id="mauSac" class="form-select" required>
                            <option th:each="mau : ${danhSachMauSac}"
                                    th:value="${mau.id}"
                                    th:text="${mau.tenMau}"
                                    th:selected="${mau.selected}">
                            </option>
                        </select>

                        <!-- K√≠ch c·ª° -->
                        <div class="mt-3">
                            <label for="kichCoId">K√≠ch c·ª°:</label>
                            <select class="form-select" name="kichCoId" id="kichCoId" required>
                                <option th:each="size : ${danhSachKichCo}"
                                        th:value="${size.id}"
                                        th:text="${size.tenKichCo}"
                                        th:selected="${size.selected}">
                                </option>
                            </select>
                        </div>

                        <!-- Gi√° s·∫£n ph·∫©m -->
                        <div class="mt-3">
                            <h5>Gi√°: <span class="fw-bold text-danger" th:text="${gia} + ' ƒë'">0 ƒë</span></h5>
                        </div>

                        <!-- S·ªë l∆∞·ª£ng c√≤n -->
                        <div class="mt-3">
                            <h5>
                                S·ªë l∆∞·ª£ng c√≤n:
                                <span th:if="${tongSoLuong > 0}" class="text-success"><strong th:text="${tongSoLuong}">0</strong></span>
                                <span th:if="${tongSoLuong == 0}" class="text-danger">H·∫øt h√†ng</span>
                            </h5>
                        </div>

                        <!-- ƒê√£ b√°n -->
                        <div class="mt-2">
                            <h5>ƒê√£ b√°n: <span class="text-info fw-bold" th:text="${soLuongDaBan}"></span> s·∫£n ph·∫©m</h5>
                        </div>

                        <!-- N√∫t mua -->
                        <div class="muasam">
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success w-100" th:disabled="${tongSoLuong == 0}">
                                    <i class="fas fa-cart-plus"></i> Th√™m v√†o gi·ªè h√†ng
                                </button>
                                <button type="submit" formaction="/mua-ngay-chi-tiet" class="btn btn-danger w-100" th:disabled="${tongSoLuong == 0}">
                                    <i class="fas fa-bolt"></i> Mua ngay
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ƒê√°nh gi√° s·∫£n ph·∫©m -->
            <hr class="my-5">
            <div class="row">
                <!-- Form ƒë√°nh gi√° -->
                <div class="col-md-6">
                    <h4>üìù Vi·∫øt ƒë√°nh gi√°</h4>
                    <form th:action="@{/danh-gia-san-pham}" method="post">
                        <input type="hidden" name="sanPhamId" th:value="${sanPham.id}" />
                        <input type="hidden" name="diem" id="diemInput" value="0">

                        <div class="mb-3">
                            <label>ƒê√°nh gi√° s·∫£n ph·∫©m:</label>
                            <div id="starContainer">
                                <span class="star" data-value="1">&#9733;</span>
                                <span class="star" data-value="2">&#9733;</span>
                                <span class="star" data-value="3">&#9733;</span>
                                <span class="star" data-value="4">&#9733;</span>
                                <span class="star" data-value="5">&#9733;</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="nhanXet">Nh·∫≠n x√©t:</label>
                            <textarea name="nhanXet" class="form-control" required></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">G·ª≠i ƒë√°nh gi√°</button>
                    </form>
                </div>

                <!-- Hi·ªÉn th·ªã ƒë√°nh gi√° -->
                <div class="col-md-6">
                    <h4>‚≠ê ƒê√°nh gi√° c·ªßa ng∆∞·ªùi d√πng</h4>
                    <p><strong>Trung b√¨nh:</strong> <span th:text="${#numbers.formatDecimal(diemTrungBinh, 1, 1)} + '/5'"></span></p>
                    <p><strong>T·ªïng s·ªë nh·∫≠n x√©t:</strong> <span th:text="${tongNhanXet}">0</span></p>
                    <ul class="list-group">
                        <li class="list-group-item" th:each="dg : ${danhGiaList}">
                            <strong th:text="${dg.nguoiDung.hoTen}">T√™n ng∆∞·ªùi d√πng</strong>
                            <span class="badge bg-warning text-dark ms-2" th:text="${dg.diem} + '‚≠ê'"></span><br/>
                            <small class="text-muted" th:text="${#temporals.format(dg.ngayDanhGia, 'dd/MM/yyyy HH:mm')}"></small><br/>
                            <span th:text="${dg.nhanXet}">Nh·∫≠n x√©t...</span>
                        </li>
                    </ul>
                    <div class="mt-3" th:if="${!daHienThiHet}">
                        <a th:href="@{'/chi-tiet/' + ${sanPham.id} + '?full=true'}" class="btn btn-primary">Xem th√™m ƒë√°nh gi√°</a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Script ƒë√°nh gi√° sao -->
    <script>
        const stars = document.querySelectorAll(".star");
        const diemInput = document.getElementById("diemInput");
        let selectedValue = 0;

        stars.forEach(star => {
            star.addEventListener("mouseover", () => {
                const val = parseInt(star.getAttribute("data-value"));
                highlightStars(val);
            });

            star.addEventListener("mouseout", () => {
                highlightStars(selectedValue);
            });

            star.addEventListener("click", () => {
                const val = parseInt(star.getAttribute("data-value"));
                selectedValue = val === selectedValue ? 0 : val;
                diemInput.value = selectedValue;
                highlightStars(selectedValue);
            });
        });

        function highlightStars(val) {
            stars.forEach(star => {
                const starVal = parseInt(star.getAttribute("data-value"));
                if (starVal <= val) {
                    star.classList.add("selected");
                } else {
                    star.classList.remove("selected");
                }
            });
        }
    </script>
</section>
</body>
</html>