<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Qu·∫£n l√Ω Gi·ªè h√†ng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        h2, h3 {
            color: #333;
        }

        .container {
            width: 80%;
            margin: 0 auto;
            padding-top: 30px;
        }

        .highlight {
            background-color: #e7f9e7;
            padding: 10px;
            margin: 15px 0;
            border-left: 5px solid #4CAF50;
            display: flex;
            align-items: center;
        }

        .error {
            background-color: #ffe0e0;
            padding: 10px;
            margin: 15px 0;
            border-left: 5px solid #d8000c;
            display: flex;
            align-items: center;
            color: #d8000c;
        }

        .error i, .highlight i {
            margin-right: 10px;
            font-size: 18px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
        }

        button, select {
            padding: 10px 15px;
            font-size: 16px;
            margin-top: 10px;
            margin-bottom: 20px;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }

        button {
            background-color: #4CAF50;
            color: white;
        }

        button:hover {
            background-color: #45a049;
        }

        .no-items {
            color: #888;
            font-size: 16px;
            margin-top: 20px;
            text-align: center;
        }

        .form-block {
            margin-bottom: 30px;
        }

        .add-user-button {
            background-color: #2196F3;
            color: white;
            padding: 10px 15px;
            text-align: center;
            display: inline-block;
            cursor: pointer;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .add-user-button:hover {
            background-color: #1976D2;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination a {
            padding: 8px 16px;
            margin: 0 5px;
            text-decoration: none;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .pagination a:hover {
            background-color: #f1f1f1;
        }

        .pagination .active {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>

<div class="container">


    <!-- üõí DANH S√ÅCH S·∫¢N PH·∫®M TRONG GI·ªé -->
    <h2>
        Danh s√°ch S·∫£n ph·∫©m trong Gi·ªè h√†ng
        <span th:if="${gioHang != null}">
    - ID: <span th:text="${gioHang.id ?: 'N/A'}"></span>
    </span>
    </h2>

    <table th:if="${gioHang != null && !#lists.isEmpty(danhSachSanPham)}">
        <thead>
        <tr>
            <th>ID</th>
            <th>Gi·ªè h√†ng ID</th>
            <th>T√™n s·∫£n ph·∫©m</th>
            <th>M√†u s·∫Øc</th>
            <th>K√≠ch c·ª°</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th><i class="fas fa-cogs"></i> Thao t√°c</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="sp : ${danhSachSanPham}">
            <td th:text="${sp.id}"></td>
            <td th:text="${sp.gioHang.id}"></td>
            <td th:text="${sp.sanPhamChiTiet.sanPham.tenSanPham}"></td>
            <td th:text="${sp.sanPhamChiTiet.mauSac.tenMau}"></td>
            <td th:text="${sp.sanPhamChiTiet.kichCo.tenKichCo}"></td>
            <td th:text="${sp.soLuong}"></td>
            <td>
                <form th:action="@{/gio-hang/huy_san_pham}" method="post" style="display:inline;">
                    <input type="hidden" name="sanPhamTrongGioHangId" th:value="${sp.id}" />
                    <button type="submit" class="add-user-button" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy s·∫£n ph·∫©m n√†y?')">
                        <i class="fas fa-user-times"></i> H·ªßy
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
    <div th:if="${gioHang != null && #lists.isEmpty(danhSachSanPham)}" class="no-items">
        <p>Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng n√†y.</p>
    </div>
    <!-- N√∫t thanh to√°n -->
    <div th:if="${gioHang != null && !#lists.isEmpty(danhSachSanPham)}">
        <form th:action="@{/gio-hang/thanh-toan}" method="get">
            <input type="hidden" name="gioHangId" th:value="${gioHang.id}" />
            <button type="submit" class="add-user-button">
                <i class="fas fa-credit-card"></i> Thanh to√°n
            </button>
        </form>
    </div>



    <!--    -->


    <h2>Qu·∫£n l√Ω Gi·ªè h√†ng</h2>

    <h3>Ch·ªçn ng∆∞·ªùi d√πng ƒë·ªÉ qu·∫£n l√Ω gi·ªè h√†ng</h3>

    <!-- Form ch·ªçn ng∆∞·ªùi d√πng -->
    <form class="form-block" th:action="@{/gio-hang/nguoi-dung}" method="get">
        <label for="nguoiDungId">Ng∆∞·ªùi d√πng:</label>
        <select name="id" id="nguoiDungId" required>
            <option value="" disabled th:selected="${nguoiDungId == null}">-- Ch·ªçn ng∆∞·ªùi d√πng --</option>
            <option th:each="nd : ${nguoiDungs}"
                    th:value="${nd.id}"
                    th:text="${nd.hoTen}"
                    th:selected="${nd.id == nguoiDungId}">
            </option>
        </select>
        <button type="submit">
            <i class="fas fa-check-circle"></i> X√°c nh·∫≠n
        </button>
        <!-- Th√™m n√∫t "Th√™m m·ªõi ng∆∞·ªùi d√πng" -->
        <a href="/gio-hang/them-nguoi-dung" class="add-user-button">
            <i class="fas fa-user-plus"></i> Th√™m m·ªõi ng∆∞·ªùi d√πng
        </a>
    </form>

    <!-- N·∫øu ƒë√£ ch·ªçn ng∆∞·ªùi d√πng -->
    <div th:if="${nguoiDungId != null}">

        <!-- Form t·∫°o gi·ªè h√†ng m·ªõi -->
        <form method="post" th:action="@{/gio-hang/tao-moi}">
            <input type="hidden" name="nguoiDungId" th:value="${nguoiDungId}" />
            <button type="submit">
                <i class="fas fa-cart-plus"></i> T·∫°o gi·ªè h√†ng m·ªõi
            </button>
        </form>

        <div th:if="${isNew}" class="highlight">
            <i class="fas fa-check-circle"></i>
            <strong>Gi·ªè h√†ng m·ªõi ƒë√£ ƒë∆∞·ª£c t·∫°o!</strong>
        </div>

        <div th:if="${isLimitReached}" class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Ng∆∞·ªùi d√πng n√†y ƒë√£ c√≥ t·ªëi ƒëa 10 gi·ªè h√†ng. Kh√¥ng th·ªÉ t·∫°o th√™m!</strong>
        </div>

        <h3 style="margin-top: 30px;">Gi·ªè h√†ng c·ªßa ng∆∞·ªùi d√πng ID [[${nguoiDungId}]]</h3>

        <div th:if="${#lists.isEmpty(gioHangs)}">
            <p class="no-items">Kh√¥ng c√≥ gi·ªè h√†ng n√†o ƒë·ªÉ hi·ªÉn th·ªã.</p>
        </div>


        <table th:if="${!#lists.isEmpty(gioHangs)}">
            <thead>
            <tr>
                <th>M√£ gi·ªè h√†ng</th>
                <th><i class="fas fa-user"></i> H·ªç T√™n</th>
                <th><i class="fas fa-calendar-alt"></i> Ng√†y t·∫°o</th>
                <th><i class="fas fa-info-circle"></i> Tr·∫°ng th√°i</th>
                <th><i class="fas fa-cogs"></i> Thao t√°c</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="gh, iterStat : ${gioHangs}" th:if="${gh.trangThai == 1}">
                <td th:text="'MGH' + ${gh.id}"></td>
                <td th:text="${gh.nguoiDung.hoTen}"></td>
                <td th:text="${#temporals.format(gh.ngayTao, 'dd-MM-yyyy HH:mm')}"></td>
                <td>
                    <span>ƒêang ch·ªù</span> <!-- Ch·ªâ c√≥ tr·∫°ng th√°i 1 n√™n c·ªë ƒë·ªãnh l√† "ƒêang ch·ªù" -->
                </td>
                <td>
                    <form th:action="@{'/gio-hang/xoa/' + ${gh.id}}" method="post" style="display:inline;">
                        <input type="hidden" name="nguoiDungId" th:value="${nguoiDungId}" />
                        <button type="submit" onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a gi·ªè h√†ng n√†y?')">
                            <i class="fas fa-trash-alt"></i> X√≥a
                        </button>
                    </form>

                    <a th:href="@{'/gio-hang/chon/' + ${gh.id} + '?id=' + ${nguoiDungId}}" class="btn btn-select">
                        <i class="fas fa-check-circle"></i> Ch·ªçn
                    </a>
                </td>
            </tr>
            </tbody>
        </table>


        <!-- PH√ÇN TRANG -->
        <div th:if="${totalPages > 1}" class="pagination">
            <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                <a th:href="@{/gio-hang/nguoi-dung(id=${nguoiDungId}, page=${i}, size=${size})}"
                   th:text="${i + 1}"
                   th:classappend="${i == currentPage} ? 'active' : ''">
                </a>
            </span>
        </div>
    </div>

    <!-- DANH S√ÅCH S·∫¢N PH·∫®M CHI TI·∫æT -->
    <h2>Danh s√°ch S·∫£n ph·∫©m Chi Ti·∫øt</h2>
    <table border="1">
        <thead>
        <tr>
            <th>ID</th>
            <th>T√™n s·∫£n ph·∫©m</th>
            <th>M√†u s·∫Øc</th>
            <th>K√≠ch c·ª°</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Gi√°</th>
            <th>Th√™m v√†o Gi·ªè h√†ng</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="spct : ${danhSachSanPhamChiTiet}">
            <td th:text="${spct.id}"></td>
            <td th:text="${spct.sanPham.tenSanPham}"></td>
            <td th:text="${spct.mauSac.tenMau}"></td>
            <td th:text="${spct.kichCo.tenKichCo}"></td>
            <td th:text="${spct.soLuong}"></td>
            <td th:text="${spct.sanPham.gia}"></td>

            <td>
                <form method="post" th:action="@{/gio-hang/them-san-pham}" th:if="${gioHang != null}">
                    <input type="hidden" name="gioHangId" th:value="${gioHang.id}" />
                    <input type="hidden" name="sanPhamChiTietId" th:value="${spct.id}" />
                    <input type="number" name="soLuong" min="1" th:value="1" max="${spct.soLuong}" required />
                    <button type="submit">
                        <i class="fas fa-cart-plus"></i> Th√™m v√†o Gi·ªè h√†ng
                    </button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Hi·ªÉn th·ªã th√¥ng b√°o -->
    <div th:if="${message != null}" class="alert alert-success">
        <p th:text="${message}"></p>
    </div>
    <div th:if="${error != null}" class="alert alert-danger">
        <p th:text="${error}"></p>
    </div>


</div>
</body>
</html>
